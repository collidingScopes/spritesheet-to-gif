<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Sheet to GIF Converter</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Sprite Sheet to GIF Converter">
    <meta name="description" content="Free web tool for animators">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://collidingscopes.github.io/spritesheet-to-gif/">
    <meta property="og:title" content="Sprite Sheet to GIF Converter">
    <meta property="og:description" content="Free web tool for animators">
    <meta property="og:image" content="https://raw.githubusercontent.com/collidingScopes/spritesheet-to-gif/main/assets/siteOGImage.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://collidingscopes.github.io/spritesheet-to-gif/">
    <meta property="twitter:title" content="Sprite Sheet to GIF Converter">
    <meta property="twitter:description" content="Free web tool for animators">
    <meta property="twitter:image" content="https://raw.githubusercontent.com/collidingScopes/spritesheet-to-gif/main/assets/siteOGImage.png">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Include the locally saved gif.js library -->
    <script src="gif.js"></script>

    <script defer src="https://cloud.umami.is/script.js" data-website-id="eb59c81c-27cb-4e1d-9e8c-bfbe70c48cd9"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3379349972139570"
    crossorigin="anonymous"></script>
</head>
<body>
    <h1>SPRITE SHEET TO GIF üëæ</h1>
    
    <div class="container">
        <!-- Neo-brutalist decorative elements -->
        <div class="neo-deco deco-square"></div>
        <div class="neo-deco deco-circle"></div>
    
        <div class="input-group">
            <label for="spriteUpload" id="spriteUploadLabel">UPLOAD SPRITE SHEET üëá</label>
            <input type="file" id="spriteUpload" accept="image/*">
        </div>
        
        <div class="main-layout">
            <div class="controls-column">
                <div class="param-grid">
                    <div class="input-group">
                        <label for="rows">NUMBER OF ROWS</label>
                        <input type="number" id="rows" value="4" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="cols">NUMBER OF COLUMNS</label>
                        <input type="number" id="cols" value="4" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="frameDelay">FRAME DELAY (MS)</label>
                        <input type="number" id="frameDelay" value="150" min="10">
                    </div>
                    
                    <!-- New offset controls -->
                    <div class="input-group">
                        <label for="offsetTop">OFFSET TOP</label>
                        <input type="number" id="offsetTop" value="0" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="offsetBottom">OFFSET BOTTOM</label>
                        <input type="number" id="offsetBottom" value="0" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="offsetLeft">OFFSET LEFT</label>
                        <input type="number" id="offsetLeft" value="0" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="offsetRight">OFFSET RIGHT</label>
                        <input type="number" id="offsetRight" value="0" min="0">
                    </div>
                    
                </div>
                
                <button id="generateBtn" disabled>GENERATE GIF üîÆ</button>
                <div id="statusText" class="status hidden"></div>
                <progress id="progressBar" value="0" max="100" class="hidden"></progress>
            </div>
            
            <div class="preview-column">
                <div id="previewContainer" class="hidden">
                    <div class="section-header">
                        <h2>SPRITE SHEET PREVIEW</h2>
                    </div>
                    <div class="preview-wrapper">
                        <img id="spritePreview" class="preview">
                        <canvas id="spritePreviewOverlay" class="preview"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="resultContainer" class="hidden">
            <div class="section-header">
                <h2>GENERATED GIF</h2>
            </div>
            <img id="gifOutput">
            <a id="downloadLink" class="hidden">
                <button class="download-btn">DOWNLOAD GIF</button>
            </a>
        </div>
        
        <div id="framePreview" class="hidden">
            <div class="section-header">
                <h2>EXTRACTED FRAMES</h2>
            </div>
            <!-- Frames will be added here -->
        </div>
    </div>
    
    <canvas id="tempCanvas" class="hidden"></canvas>

    <div id="notesDiv">
        <div id="textBox">
  
            <h2 id="aboutText">Sprite Sheet to GIF ConverterüåÄ</h2>
            <img class="example-image" src="assets/siteOGImage.png"> 
            <img class="example-image" src="assets/sprite-animation.gif"> 
            <p>This is a free web tool that turns sprite sheets into animated GIFs. Useful for video game creators and animators!</p>
            <p>Upload your spritesheet image, and then use the controls to set row / column count, frame duration, and image offset margins.</p>
            <p>The tool then converts your sprite sheet into a GIF file.</p>
            <p>This tool is completely free, open source (MIT license), without any paywalls or premium options. You are welcome to use it for personal or commercial purposes.</p>
            <p>If you found this tool useful, feel free to buy me a coffee. My name is Alan, and I enjoy building open source software for art, animation, games, and more. This would be much appreciated during late-night coding sessions!</p>
            <a href="https://www.buymeacoffee.com/stereoDrift" target="_blank"><img src="https://www.buymeacoffee.com/assets/img/custom_images/yellow_img.png" alt="Buy Me A Coffee"></a>  
            <p>This project is coded using vanilla Javascript, HTML5 canvas, and CSS (<a href="https://github.com/collidingScopes/spritesheet-to-gif" target="_blank" rel="noopener">see github repo</a>). GIF creation is done using the gif.js library created by Johan Nordberg.</p>
            <p>If you enjoyed this, you may be interested in my other free / open source projects:</p>
            <ul>
              <li><a href="https://collidingScopes.github.io/particular-drift" target="_blank" rel="noopener">Particular Drift</a>: turn photos into flowing particle animations</li>
              <li><a href="https://collidingScopes.github.io/liquid-logo" target="_blank" rel="noopener">Liquid Logo</a>: turn logos and icons into liquid metal animations</li>
              <li><a href="https://collidingScopes.github.io/ascii" target="_blank" rel="noopener">Video-to-ASCII</a>: turn videos into ASCII pixel art</li>
              <li><a href="https://collidingScopes.github.io/shimmer" target="_blank" rel="noopener">Shape Shimmer</a>: turn photos into funky wave animations</li>
              <li><a href="https://collidingScopes.github.io" target="_blank" rel="noopener">Colliding Scopes</a>: turn photos into kaleidoscope animations</li>
              <li><a href="https://manual-brick-breaker.netlify.app" target="_blank" rel="noopener">Manual Brick Breaker</a>: play brick breaker by waving your hands around</li>
            </ul>
            <p>Feel free to reach out to discuss, give suggestions, or just to say hi! You can find me <a href="https://www.instagram.com/stereo.drift/" target="_blank" rel="noopener">@stereo.drift</a> on instagram, or through the other places below :)</p>
        </div>
      </div>
  
      <div id="linksDiv">
        <table id="infoMenuTable">
            <tr>
                <td><button id="gitHubButton"class="socialMediaButton"><a href="https://github.com/collidingScopes/spritesheet-to-gif" target="_blank" rel="noopener"><i class="fa-brands fa-github"></i></a></button></td>
                <td><button id="coffeeButton" class="socialMediaButton"><a href="https://www.buymeacoffee.com/stereoDrift" target="_blank" rel="noopener"><i class="fa-solid fa-heart"></i></a></button></td>
                <td><button id="instagramButton" class="socialMediaButton"><a href="https://www.instagram.com/stereo.drift/" target="_blank" rel="noopener"><i class="fa-brands fa-instagram"></i></a></button></td>
                <td><button id="xButton" class="socialMediaButton"><a class="x-link" href="https://x.com/measure_plan" target="_blank" rel="noopener">ùïè</i></a></button></td>
                <td><button id="emailButton" class="socialMediaButton"><a href="mailto:stereodriftvisuals@gmail.com" target="_blank" rel="noopener"><i class="fa-solid fa-envelope"></i></a></button></td>
            </tr>
        </table>
      </div>
    
    <!-- JavaScript remains the same -->
    <script>
        // DOM Elements
        const spriteUpload = document.getElementById('spriteUpload');
        const generateBtn = document.getElementById('generateBtn');
        const spritePreview = document.getElementById('spritePreview');
        const spritePreviewOverlay = document.getElementById('spritePreviewOverlay');
        const previewContainer = document.getElementById('previewContainer');
        const resultContainer = document.getElementById('resultContainer');
        const gifOutput = document.getElementById('gifOutput');
        const downloadLink = document.getElementById('downloadLink');
        const tempCanvas = document.getElementById('tempCanvas');
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const framePreview = document.getElementById('framePreview');
        
        // Form inputs
        const rowsInput = document.getElementById('rows');
        const colsInput = document.getElementById('cols');
        const frameDelayInput = document.getElementById('frameDelay');
        
        // New offset inputs
        const offsetTopInput = document.getElementById('offsetTop');
        const offsetBottomInput = document.getElementById('offsetBottom');
        const offsetLeftInput = document.getElementById('offsetLeft');
        const offsetRightInput = document.getElementById('offsetRight');
        
        // Variables
        let spriteSheet = null;
        
        // Example spritesheet path
        const exampleSpritesheetPath = 'assets/example-spritesheet.png';
        
        // Event listeners
        spriteUpload.addEventListener('change', handleSpriteUpload);
        generateBtn.addEventListener('click', generateGif);
        
        // Load example spritesheet on page load
        window.addEventListener('DOMContentLoaded', loadExampleSpritesheet);
        
        // Add event listeners for real-time grid updates
        rowsInput.addEventListener('input', updateGridLines);
        colsInput.addEventListener('input', updateGridLines);
        offsetTopInput.addEventListener('input', updateGridLines);
        offsetBottomInput.addEventListener('input', updateGridLines);
        offsetLeftInput.addEventListener('input', updateGridLines);
        offsetRightInput.addEventListener('input', updateGridLines);
        
        function handleSpriteUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    spriteSheet = img;
                    spritePreview.src = img.src;
                    previewContainer.classList.remove('hidden');
                    generateBtn.disabled = false;
                    
                    // Set up the overlay canvas to match the sprite sheet size
                    spritePreviewOverlay.width = img.width;
                    spritePreviewOverlay.height = img.height;
                    
                    // Draw the grid lines after image is loaded
                    updateGridLines();
                    
                    // Clear previous results
                    resultContainer.classList.add('hidden');
                    framePreview.innerHTML = '<div class="section-header"><h2>EXTRACTED FRAMES</h2></div>';
                    framePreview.classList.add('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function updateGridLines() {
            if (!spriteSheet) return;
            
            // Get current rows and columns values
            const rows = parseInt(rowsInput.value) || 4;
            const cols = parseInt(colsInput.value) || 4;
            
            // Get offset values
            const offsetTop = parseInt(offsetTopInput.value) || 0;
            const offsetBottom = parseInt(offsetBottomInput.value) || 0;
            const offsetLeft = parseInt(offsetLeftInput.value) || 0;
            const offsetRight = parseInt(offsetRightInput.value) || 0;
            
            // Calculate effective dimensions after offsets
            const effectiveWidth = spriteSheet.width - offsetLeft - offsetRight;
            const effectiveHeight = spriteSheet.height - offsetTop - offsetBottom;
            
            // Calculate frame dimensions
            const frameWidth = Math.floor(effectiveWidth / cols);
            const frameHeight = Math.floor(effectiveHeight / rows);
            
            // Get canvas context and clear previous drawings
            const ctx = spritePreviewOverlay.getContext('2d');
            ctx.clearRect(0, 0, spritePreviewOverlay.width, spritePreviewOverlay.height);
            
            // Set line style
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 3;
            
            // Draw outer border to show offset area
            ctx.beginPath();
            ctx.rect(
                offsetLeft, 
                offsetTop, 
                effectiveWidth, 
                effectiveHeight
            );
            ctx.stroke();
            
            // Draw vertical lines
            for (let col = 1; col < cols; col++) {
                const x = offsetLeft + (col * frameWidth);
                ctx.beginPath();
                ctx.moveTo(x, offsetTop);
                ctx.lineTo(x, spritePreviewOverlay.height - offsetBottom);
                ctx.stroke();
            }
            
            // Draw horizontal lines
            for (let row = 1; row < rows; row++) {
                const y = offsetTop + (row * frameHeight);
                ctx.beginPath();
                ctx.moveTo(offsetLeft, y);
                ctx.lineTo(spritePreviewOverlay.width - offsetRight, y);
                ctx.stroke();
            }
        }
        
        function generateGif() {
            if (!spriteSheet) return;
            
            // Get parameters
            const rows = parseInt(rowsInput.value) || 4;
            const cols = parseInt(colsInput.value) || 4;
            const frameDelay = parseInt(frameDelayInput.value) || 150;
            const quality = 10;
            
            // Get offset values
            const offsetTop = parseInt(offsetTopInput.value) || 0;
            const offsetBottom = parseInt(offsetBottomInput.value) || 0;
            const offsetLeft = parseInt(offsetLeftInput.value) || 0;
            const offsetRight = parseInt(offsetRightInput.value) || 0;
            
            // Calculate effective dimensions after offsets
            const effectiveWidth = spriteSheet.width - offsetLeft - offsetRight;
            const effectiveHeight = spriteSheet.height - offsetTop - offsetBottom;
            
            // Calculate frame dimensions
            const frameWidth = Math.floor(effectiveWidth / cols);
            const frameHeight = Math.floor(effectiveHeight / rows);
            
            // Set up canvas
            tempCanvas.width = frameWidth;
            tempCanvas.height = frameHeight;
            const ctx = tempCanvas.getContext('2d');
            
            // Show status and progress
            statusText.textContent = 'EXTRACTING FRAMES...';
            statusText.classList.remove('hidden');
            progressBar.classList.remove('hidden');
            progressBar.value = 0;
            generateBtn.disabled = true;
            framePreview.innerHTML = '<div class="section-header"><h2>EXTRACTED FRAMES</h2></div>';
            framePreview.classList.remove('hidden');
            
            // Create GIF
            const gif = new GIF({
                workers: 2,
                quality: quality,
                width: frameWidth,
                height: frameHeight,
                workerScript: 'gif.worker.js'  // Use local worker script
            });
            
            // Total number of frames
            const totalFrames = rows * cols;
            let framesDone = 0;
            
            // Process frames row by row, left to right
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    // Clear canvas
                    ctx.clearRect(0, 0, frameWidth, frameHeight);
                    
                    // Calculate source coordinates with offsets
                    const sourceX = offsetLeft + (col * frameWidth);
                    const sourceY = offsetTop + (row * frameHeight);
                    
                    // Draw current frame on canvas with offsets applied
                    ctx.drawImage(
                        spriteSheet,
                        sourceX,
                        sourceY,
                        frameWidth,
                        frameHeight,
                        0,
                        0,
                        frameWidth,
                        frameHeight
                    );
                    
                    // Add frame to preview
                    const frameImg = document.createElement('img');
                    frameImg.src = tempCanvas.toDataURL('image/png');
                    framePreview.appendChild(frameImg);
                    
                    // Add frame to GIF
                    gif.addFrame(ctx, {
                        copy: true,
                        delay: frameDelay
                    });
                    
                    // Update progress
                    framesDone++;
                    progressBar.value = (framesDone / totalFrames) * 50; // Save 50% for rendering
                }
            }
            
            // GIF events
            gif.on('progress', function(p) {
                progressBar.value = 50 + (p * 50); // Last 50% for rendering
                statusText.textContent = `RENDERING GIF: ${Math.round(p * 100)}%`;
            });
            
            gif.on('finished', function(blob) {
                // Display the GIF
                const url = URL.createObjectURL(blob);
                gifOutput.src = url;
                downloadLink.href = url;
                downloadLink.download = 'sprite-animation.gif';
                
                // Show results
                resultContainer.classList.remove('hidden');
                downloadLink.classList.remove('hidden');
                progressBar.classList.add('hidden');
                statusText.textContent = 'GIF CREATED SUCCESSFULLY!';
                generateBtn.disabled = false;
            });
            
            // Start rendering
            statusText.textContent = 'RENDERING GIF...';
            gif.render();
        }
        
        function loadExampleSpritesheet() {
            // Create an Image object
            const img = new Image();
            
            // Set up onload handler
            img.onload = function() {
                spriteSheet = img;
                spritePreview.src = img.src;
                previewContainer.classList.remove('hidden');
                generateBtn.disabled = false;
                
                // Set up the overlay canvas to match the sprite sheet size
                spritePreviewOverlay.width = img.width;
                spritePreviewOverlay.height = img.height;
                
                // Draw the grid lines after image is loaded
                updateGridLines();
                
                // Clear previous results
                resultContainer.classList.add('hidden');
                framePreview.innerHTML = '<div class="section-header"><h2>EXTRACTED FRAMES</h2></div>';
                framePreview.classList.add('hidden');
            };
            
            // Set source to example spritesheet
            img.src = exampleSpritesheetPath;
        }
    </script>
</body>
</html>